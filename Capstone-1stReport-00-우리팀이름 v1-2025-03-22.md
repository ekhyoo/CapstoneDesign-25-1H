<!-- Template for PROJECT REPORT of CapstoneDesign 2025-2H, initially written by khyoo -->
<!-- 본 파일은 2025년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 |  AI NPC 입체적 역할 부여를 통해 단조로운 대화패턴을 탈피한 <변호사 VS 검사> 재판 멀티플레이 게임 |
|:---  |---  |
| (2) 팀 번호/이름 | 33-아리아리 |
| (3) 구성원 | 전유진 (2116020): 리더,*PM, 클라이언트* <br> 박시언 (2140015): 팀원,*기획, AI* <br> 유서현(2071031): 팀원,*기획, 서버* |
| (4) 지도교수 | 김영준 교수 |
| (5) 트랙  | 산학 |
| (6) 과제 키워드 | 생성형 AI를 통한 컨텐츠 자동생성, AI NPC와의 커뮤니케이션, 멀티플레이 게임, 재판 |
| (7) 과제 내용 요약 |  꽥투헬은 저승과 이승의 경계인 삼도천에서 망자를 천국 또는 지옥으로 보내기 위해 경쟁하는 2인 재판 게임이다. 스테이지는 마을(증거수집 현장)과 재판장(재판 현장)으로 나뉜다. 플레이어는 마을에서 NPC와의 대화 및 증거물 수집을 통해 단서를 얻고, 이를 토대로 재판장에서 어필할 수 있다. 게임의 핵심 기술은 AI이며, AI는 ① 매 판 자동 콘텐츠 생성을 담당하는 God, ② 플레이어와 대화하는 NPC, ③ DALL·E 기반의 증거물 이미지 생성, ④ 재판을 주관하는 판사 AI로 구성되어 있다.  <br><br> ※ 본 게임은 사회적 메시지나 진지한 법적 토론을 목표로 하지 않으며, 플레이어는 재판에서 승리하기 위해 수단과 방법을 가리지 않는 경쟁을 펼친다. 플레이어는 NPC를 회유하거나, 불리한 증거를 숨기고, 재판장을 자신의 논리로 설득하는 등 승부에 집중한 플레이 경험을 즐길 수 있도록 설계되어 있다.|
| (8) 주요 Link | 꽥투헬 깃허브 레포지토리: https://github.com/AriAri-Project|

<br>

# Project-Summary

| 항목 | 내용 |
|:---|:---|
| (1) 문제 정의 | **Target Customer**<br>1. 마피아 게임이나 채팅형 어필 경쟁 게임을 선호하는 유저<br>2. 재판 게임 장르를 즐기는 유저<br>3. 플레이할 때마다 다른 상황이 펼쳐지는, 리플레이성이 높은 게임을 선호하는 유저<br>4. 단순한 규칙 속에서 예측 불가능하고 다이나믹한 상황 전개를 즐기는 유저<br><br>**Pain Points**<br>1. 기존게임: 정해진 캐릭터 & 고정된 스토리로 인한 단조로운 대화 패턴<br>2. 인디게임의 한계: 빠른 콘텐츠 소모 속도를 기획 생산력이 따라가지 못 함<br>3. 기존 게임: AI를 단순 조력자 / 적으로 배치 (역할 고정) |
| (2) 기존연구와의 비교 | **유사 게임 사례**<br>1. 고정된 캐릭터 & 스토리 → 대화 패턴이 단조로운 게임<br>  - 《역전재판》 시리즈<br>  → 사전에 제작된 고정 스토리와 캐릭터 대사에 기반해 진행되며, 반복 플레이 시 동일한 스토리라인과 대화 패턴 노출로 인해 리플레이성 한계 존재.<br>2. 빠른 콘텐츠 소비 속도를 기획 생산력이 따라가지 못하는 사례<br>  - 《스타듀밸리 (Stardew Valley)》<br>  → 개발자 1인이 모든 콘텐츠를 기획·개발했기 때문에, 업데이트 주기가 매우 길고 불규칙함.<br>3. AI 역할이 고정되어 있는 게임 사례<br>  - 《두근두근 AI 심문게임》<br>  → AI 역할이 심문 대상에 고정되어 있으며, 플레이어의 행동이나 선택에 따라 AI의 입장이나 목적이 변화하지 않음.<br><br>**기존 사례의 한계점**<br>1. 고정된 콘텐츠 구조<br>→ 기존 재판/추리 게임은 사전에 제작된 캐릭터, 스토리, 대사에 의존하여 플레이 횟수에 따라 콘텐츠 소모와 재미 감소 문제가 있음.<br>2. AI 활용의 제한성<br>→ 기존 AI 게임들은 스토리 자동생성 기능에 집중되어 있지만, 플레이어의 행동에 따른 AI 역할 변화 구조는 부재. 기존의 AI 게임은 AI 역할이 고정되어있다는 한계가 있음.<br>3. 리플레이성 한계<br>→ 기존 AI 게임들은 플레이어의 선택에 따라 NPC의 입장이나 게임 전개가 근본적으로 달라지지 않음. 인력으로 기획 리소스를 제작한 게임은, 컨텐츠 소모 속도를 기획이 따라가지 못해 리플레이를 제한한다는 단점이 있음. <br><br>**본 과제의 차별성 및 장점**<br>1. 생성형 AI 기반의 콘텐츠 생성으로 매 판마다 새로운 재판 사건, NPC 인격, 증거물이 자동 생성되어 콘텐츠 고갈 문제를 구조적으로 해결.<br>2. 플레이어의 행동과 평판 관리에 따라 NPC의 증언 내용과 게임 승패가 실시간으로 변화하는 능동적 게임 구조 구현.<br>3. 기존 AI 게임과 달리, AI가 조력자·적의 고정된 역할에 머무르지 않고, 플레이어가 원하는 방향으로 역할을 유도할 수 있는 시스템 적용.<br>4. 인디게임 개발 리소스 한계를 AI 기술로 극복하여 지속 가능한 서비스 가능성 확보. |
| (3) 제안 내용 | 1. 기존게임: 정해진 캐릭터 & 고정된 스토리로 인한 단조로운 대화 패턴<br>→ 우리게임: 생성형 ai로 매 판 NPC의 인격 & 스토리를 자동 생성해 정적인 캐릭터성 극복 & 다채로운 대화패턴 상황을 연출함. 매 판 다른 NPC성격과 상황을 통해 예측 불가능한 레퍼토리와 몰입감있는 플레이를 제공함.<br><br>2. 인디게임의 한계: 빠른 콘텐츠 소모 속도를 기획 생산력이 따라가지 못 함<br>→ 우리게임: 생성형 ai 사용해 매 판마다 새로운 재판 사건과 단서, NPC 인격을 자동 생성함으로써 기획 리소스 소모 없이 콘텐츠 고갈 문제를 해결함.<br><br>3. 기존 게임: AI를 단순 조력자 / 적으로 배치 (역할 고정)<br>→ 우리게임: 플레이어는 게임 내에서 NPC와의 대화, 행동, 평판 관리를 통해 AI NPC의 역할을 능동적으로 변화시킬 수 있음. 즉, AI의 역할이 고정되어 있는 것이 아니라, 플레이어가 원하는 방향으로 AI가 행동하도록 유도해야 함. 최종적으로, 마을에서의 플레이어의 행동이 재판장에서 NPC의 증언으로 이어지며, 그 증언이 플레이어에게 유리하게 작용해 게임의 승패에 영향을 미치도록 설계함. |
| (4) 기대효과 및 의의 | **사회적 영향력**<br>1. 산업 혁신 선도: 생성형 AI를 활용한 멀티플레이 재판 추리 게임으로, AI 기반 스토리텔링과 경쟁 구조의 결합이라는 새로운 게임 장르의 가능성 제시.<br>2. 사회적 대화 촉진 가능성: 게임의 법적 설정과 플레이 경험이, 현실 사회의 법적·윤리적 쟁점에 대한 가벼운 토론의 출발점이 될 수 있음.<br>3. AI 판사 논의의 소재 제공: AI 판사 NPC의 도입이 AI의 공정성, 책임성에 대한 논의의 소재로 활용될 가능성.<br><br>**콘텐츠 산업 기여도**<br>1. 스토리텔링 방식의 확장 가능성: 매 판 자동 생성되는 캐릭터·사건 구조가, 게임 산업 내 AI 기반 동적 서사 제공 모델로 확장될 수 있음.<br>2. AI 기술의 게임 개발 적용 가능성 제시: AI 도구를 통해 콘텐츠 제작 효율을 높이는 AI 기반 게임 개발의 사례로 활용될 수 있음.<br>3. 교육·토론 도구로의 확장 가능성: 플레이어가 증거를 숨기거나 NPC를 조종하는 시스템 구조가, 향후 법적·윤리적 딜레마 학습 도구로 전환될 여지도 있음. |
| (5) 주요 기능 리스트 | 게임의 핵심 기술은 생성형 AI이며, OpenAI API를 사용한다. AI는 다음 네 가지 구성 요소로 이루어져 있다.<br><br>1. God 시스템 (콘텐츠 자동 생성 담당)<br>- 매 판마다 피고인과 NPC들의 배경 스토리, 성격, 가치관, 말투, 특성 등 플레이에 필요한 설정을 자동 생성한다.<br>- OpenAI API를 활용해 NPC별 프롬프트를 생성하고, 결과를 JSON 데이터로 저장하여 게임 내 스토리 정보로 활용한다.<br>- 생성된 JSON 데이터에는 NPC의 이름, 성격, 전생의 주요 사건 등이 포함되며, 게임 내 대화 컨텍스트 유지에 활용된다.<br><br>2. NPC Component 모듈 (실시간 대화 상호작용)<br>- 플레이어와 NPC 간 상호작용을 담당하며, 플레이어의 질문을 OpenAI에 전달하고, 생성된 답변을 받아 게임 내에서 NPC의 발화로 표현한다.<br>- NPC 간 자체 대화 (N2N) 및 NPC의 혼잣말 기능을 포함한다.<br>- 대화 유형(ConversationType)에 따라 상호작용 방식을 구분하여, 자연스럽고 일관된 캐릭터성을 유지한다. 대화 유형은 Player-NPC, NPC-NPC, NPC혼잣말로 구성되어있다.<br>- 플레이어와 NPC 간의 대화 기록을 지속적으로 저장·관리하여, 이전 맥락과 연결되는 자연스러운 대화 흐름을 제공한다.<br><br>3. DALL·E 기반 증거물 이미지 생성<br>- 매 판 새로운 재판 사건에 필요한 증거물 이미지를 자동 생성하여, 시각적 콘텐츠 제공 및 몰입도를 높인다.<br><br>4. 판사 AI<br>- 재판장에서의 진행을 담당하며, AI 판사 NPC로서 플레이어 간 논리 대결을 판정한다.<br>- 판례를 학습하여 파인튜닝된 모델로서 재판을 수행한다. |


<br>
 
# Project-Design & Implementation
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 |(1) God 시스템<br>• 유스케이스:<br>  - 게임 시작 전, 피고인을 포함한 NPC들의 개별적인 성격, 배경 스토리, 주요 사건 정보, 그리고 증거물 아이템과 관련된 설정을 자동 생성한다.<br>  - 생성된 데이터는 JSON 파일로 저장되어 각 NPC들의 대화를 OpenAI를 통해 생성할 시 참조할 수 있도록 한다.<br>• 세부 기능 요구사항:<br>  - 랜덤성 및 가이드라인을 기반으로 NPC들의 성격과 배경을 자동 생성할 수 있어야 한다.<br>  - 생성된 정보는 NPC의 대화 및 반응에 영향을 미쳐야 한다.<br>  - NPC들이 특정 행동(거짓말, 회피 등)을 할 확률을 성격에 따라 조절할 수 있도록 요구사항에 맞추어 자세히 설정해야 한다.<br><br>(2) NPCComponent (대화 AI 모듈)<br>• 유스케이스:<br>  - 플레이어가 NPC에게 질문을 하면, NPC가 OpenAI를 통해 콜백을 진행하고 해당 질문과 관련된 답변을 생성해 받아온다.<br>  - 이때 NPC의 답변은 해당 NPC 본인의 기억, 성격, 사건 정보가 담긴 JSON에 따라 맞추어 조정된다.<br>  - 또한, NPC는 무조건 옳은 말만 하는 것이 아니라 거짓말을 하거나 회피하는 등 플레이어에게 다양한 반응을 보일 수 있다.<br>  - NPC는 플레이어와 나눈 대화 기록을 바탕으로 다른 NPC와 대화를 하거나, 혼잣말을 출력할 수도 있다.<br>• 세부 기능 요구사항:<br>  - 대화 데이터는 OpenAI API를 활용하여 실시간으로 생성한다.<br>  - NPC별 본인의 기억 데이터를 참조하여 개개인의 일관된 응답을 유지해야 한다.<br>  - 특정 이벤트(증거 제시 등) 이후 NPC의 태도 변화가 대사에 반영되어야 한다.<br><br>(3) 재판 시스템<br>• 유스케이스:<br>  - 재판은 모두진술, 증거조사, 피고인 심문, 배심원 발언, 최종판결 순으로 이루어진다.<br>  - 플레이어가 심문을 통해 얻은 정보를 바탕으로 NPC의 진술에 포함된 모순을 찾아낸다.<br>  - 증거를 제시하면 NPC의 반응에 실시간으로 반영되어 변화하고, 이에 따라 재판의 흐름이 달라진다.<br>  - 최종적으로 판사 AI가 내린 판결이 피고의 운명과 게임의 승패를 결정한다.<br>• 세부 기능 요구사항:<br>  - 증거 제시에 따라 배심원 NPC들의 의견이 달라질 수 있어야 한다.<br>  - 최종 판결 결과가 저장되며, 이후 게임에 영향을 줄 수 있어야 한다.<br><br>1.2 설계 모델 (클래스 및 모듈 명세서)<br>(1) 주요 클래스 다이어그램<br>• GodCall: NPC의 초기 설정을 담당하는 모듈.<br>• GodFunction: 랜덤 데이터 생성 및 NPC 설정 저장.<br>• NPCComponent: AI 기반 대화를 처리하는 NPC 모듈 (Resident, Jury, Defendant의 부모 클래스).<br>• ResidentComponent, JuryComponent, DefendantComponent: 각각 마을 주민, 배심원, 피고인을 담당하며 NPCComponent를 상속받음.<br>• TrialStatement: 재판 진행을 관리하는 클래스. |
| (2) 전체 시스템 구성 | ![image](https://github.com/user-attachments/assets/cd12a8b0-7fe8-42d6-be60-25ed3dfb4c9b) |
| (3) 주요엔진 및 기능 설계 | 꽥투헬 클라이언트는 Unreal Engine의 핵심 클래스를 확장한 계층적 구조를 기반으로 구현되며, 캐릭터와 컨트롤러가 명확히 분리되어 각 역할에 맞게 설계된다.<br>기본 캐릭터인 QCharacter를 중심으로 플레이어와 NPC가 각각 QPlayer, QNPC로 구분되며, 세부적으로는 QLawyer, QProsecutor, QDefendant, QDynamicNPC 등이 존재하고, NPC의 경우 정적과 동적 구분에 따라 QJury, QResident 등이 추가 상속된다.<br>이에 맞춰 플레이어와 NPC를 제어하는 컨트롤러 역시 QPlayerController와 QNPCController로 구분되고, 동적 NPC는 QDynamicController를 통해 QJuryController, QResidentController 등으로 세분화된다.<br>UI 측면에서는 씬별 관리자인 QVillageUIManager와 QCourtUIManager가 단일 인스턴스(Singleton) 형태로 전체 인터페이스를 통합 관리하며, 기타 UI 요소들은 해당 관리자를 통해 생성 및 제거된다.<br><br>서버 구현 측면에서는 언리얼 리슨 서버(Unreal Listen Server)를 활용하여 클라이언트와 AI 시스템 간의 안정적인 통신 채널을 구축하고 있다.<br>데디케이티드 서버가 아니기에 서버는 각 세션의 호스트의 로컬 환경에서 구동됩니다.<br>이를 통해 클라이언트는 AI(즉, God 시스템과 NPCComponent 모듈)와의 원활한 상호작용을 보장받으며, 게임 내 다양한 NPC의 배경 스토리, 성격, 말투 등 복합적인 데이터를 실시간으로 주고받을 수 있다.<br>또한, Unreal의 OnlineSubsystem을 활용하여 LAN 환경에 국한되지 않고 WAN 환경에서도 멀티플레이어 유저를 효과적으로 탐색하고, 세션을 형성할 수 있도록 구현하였다.<br>이를 통해 전 세계의 플레이어들이 하나의 네트워크에서 안정적으로 연결되고, 원활한 게임 플레이를 경험할 수 있다.<br><br>꽥투헬의 AI 시스템은 God 시스템과 NPCComponent 모듈을 중심으로 설계되어 있다.<br>God 시스템은 AI의 핵심 엔진 역할을 하며, 피고인을 포함한 NPC들의 개별적인 배경 스토리, 성격 및 가치관, 말투, 특성 등을 생성하는 역할을 수행한다.<br>이 과정에서 God은 OpenAI API를 활용하여 NPC별 프롬프트를 생성하고, 그 결과를 JSON 파일로 저장함으로써 NPC들의 개성을 반영한 JSON SCHEMA를 만든다.<br>더불어 NPC들의 JSON에는 이름, 성격, 전생의 주요 사건 등이 포함되며, 이러한 정보는 게임 내에서 NPC들의 대화 컨텍스트 유지에도 활용된다.<br><br>한편, NPCComponent 모듈은 개별 NPC가 플레이어와 상호작용하는 기능을 담당한다.<br>NPC가 플레이어의 질문을 받으면 해당 요청을 OpenAI에 전달하고, OpenAI가 생성한 응답을 다시 받아 서버에 보내는 역할을 한다.<br>NPCComponent는 단순히 OpenAI의 응답을 전달하는 것뿐만 아니라, NPC들끼리 대화를 주고받는 기능(N2N)과 NPC가 혼잣말을 하는 기능도 포함하고 있다.<br>이를 위해 NPCComponent는 대화 유형을 ConversationType으로 구분하여 처리하며, UI 출력 시스템과 연동하여 NPC의 발화를 자연스럽게 게임 내에서 표현할 수 있도록 설계되어 있다.<br>또한, 대화 기록을 저장하고 관리하여 NPC의 발언이 이전 맥락과 어울리도록 조정하는 역할도 수행한다.<br>NPC와 플레이어의 대화 기록은 지속적으로 저장되고 이후 NPC 간 대화 및 그들의 혼잣말에 반영하여, NPC가 더욱 자연스럽고 일관된 성격을 유지할 수 있도록 한다.<br><br>이러한 구조를 통해 꽥투헬의 AI 시스템은 각 NPC들이 개별적인 개성을 유지하면서도 플레이어와 몰입도 높은 상호작용을 할 수 있도록 돕는다.<br>God 시스템이 피고인 및 NPC의 배경 스토리, NPC의 성격 등 게임의 바탕이 되는 모든 설정들을 생성하고, NPCComponent가 이를 게임 내에서 실시간으로 반영하는 방식으로 구현되어 있어, 플레이어는 마치 하나의 작은 사회에 속한 듯한 경험을 할 수 있다. |
| (4) 주요 기능의 구현 | God 기능 상세 구현 내용<br>1. 기능 개요<br>• God 기능은 꽥투헬 세계관 내 NPC들의 배경 스토리, 성격, 역할을 자동으로 생성하는 시스템이다.<br>• OpenAI API를 활용해, NPC 각각의 설정 데이터(JSON 파일)를 자동 생성한다.<br>• 생성된 데이터는 게임 내 NPCComponent가 참조하여, NPC의 대화 및 행동에 반영된다.<br><br>2. 주요 기능 흐름<br>• PromptToGod.json → PromptToDefendant.json → PromptToJury.json → PromptToResident.json 순서로 계층적 데이터 생성<br>1. PromptToGod.json<br>  - 개발자가 작성한 세계관 기초 설정 파일<br>2. PromptToDefendant.json<br>  - 피고인 NPC의 상세 정보 생성<br>3. PromptToJuryX.json<br>  - 배심원 NPC 3명의 정보 순차 생성<br>4. PromptToResidentX.json<br>  - 마을 주민 NPC 5명의 정보 순차 생성<br>• 파일 저장 경로<br>  - Saved/Prompt/ 폴더에 각 NPC의 JSON 데이터 파일로 저장<br><br>3. 기능 세부 구조<br>• UGodFunction<br>  - CallOpenAIAsync(): OpenAI API 호출 비동기 처리 및 3회 재시도 기능<br>  - SavePromptToFile(): 생성된 프롬프트 데이터를 JSON 파일로 저장<br>  - GenerateDefendantPrompt(): 피고인 NPC 정보 생성<br>  - GenerateJuryNPC(): 배심원 NPC 순차 생성<br>  - GenerateResidentNPC(): 마을 주민 NPC 순차 생성<br>  - ExtractValidJson() / CleanUpJson(): OpenAI 응답에서 유효한 JSON 데이터만 추출 및 정제<br>• UGodCall<br>  - 게임 시작 시 자동 호출<br>  - PostInitProperties()에서 NPC 데이터 생성 시작<br>  - World context를 통해 World 객체 접근 후 GodFunction 호출<br><br>NPCComponent 상세 구현 내용<br>1. 기능 개요<br>• UNPCComponent는 NPC Actor에 부착되어, NPC의 대화, 혼잣말, 재판 진술 등 AI 기반 발화 기능을 담당한다.<br>• NPC 간 대화(N2N), 플레이어와 NPC 대화(P2N), 혼잣말(NMonologue), 재판 모두진술(OpeningStatement) 등 다양한 상황을 처리한다.<br><br>2. 기능 세부 구조<br>• NPC 설정 정보 로딩 - LoadPrompt()<br>  - God 기능에서 생성한 NPC의 JSON 데이터 파일을 읽고, NPCID, 이름, 역할, 성격 등의 정보를 메모리에 로드<br>• 대화 처리 기능<br>  - P2N 대화 - StartConversation(): 플레이어가 NPC에게 말을 걸 때, NPC의 세계관 설정과 대화 히스토리를 바탕으로 대답 생성<br>  - N2N 대화 - StartNPCToNPCDialog() → ContinueNPCToNPCDialog(): NPC 두 명이 서로 자연스럽게 대화하도록 AI에 요청하고, 최대 4턴까지 자동 대화 이어나감<br>  - 혼잣말(NMonologue) - PerformNPCMonologue(): 최근 플레이어와의 대화 내용을 바탕으로, NPC 혼잣말 생성<br>  - 재판 모두진술(OpeningStatement) - TrialStatement(): 피고인 NPC가 자신의 과거에 대한 진술을 AI를 통해 생성<br>• 대화 히스토리 관리<br>  - 플레이어와 NPC 간 대화 기록을 P2NDialogueHistory에 저장하여, NPC의 발화에 반영<br>• 서버와 동기화<br>  - NPC의 대화 결과는 서버에 전송되어 대화 기록으로 저장되며, UI에도 실시간 표시 (SendNPCResponseToServer()) |
| (5) 기타 | - |

<br>
